{
	"$schema": "https://shadcn-svelte.com/schema/registry-item.json",
	"name": "autocomplete",
	"title": "Autocomplete",
	"type": "registry:ui",
	"description": "An input component with autocomplete suggestions.",
	"dependencies": [
		"lucide-svelte@^0.554.0"
	],
	"registryDependencies": [
		"input"
	],
	"files": [
		{
			"content": "<script lang=\"ts\" generics=\"T\">\r\n    import { Input } from \"$lib/components/ui/input\";\r\n    import { cn } from \"$UTILS$\";\r\n    import { Loader2, Search, X } from \"lucide-svelte\";\r\n    import { fly } from \"svelte/transition\";\r\n    import type { Snippet } from \"svelte\";\r\n\r\n    let {\r\n        value = $bindable(\"\"),\r\n        selected = $bindable<T | null>(null),\r\n        options = [],\r\n        loading = false,\r\n        placeholder = \"Search...\",\r\n        class: className,\r\n        onSelect,\r\n        itemSnippet,\r\n        emptySnippet,\r\n        ...rest\r\n    }: {\r\n        value: string;\r\n        selected?: T | null;\r\n        options: T[];\r\n        loading?: boolean;\r\n        placeholder?: string;\r\n        class?: string;\r\n        onSelect?: (item: T) => void;\r\n        itemSnippet: Snippet<[T, boolean]>;\r\n        emptySnippet?: Snippet;\r\n        [key: string]: any;\r\n    } = $props();\r\n\r\n    let isOpen = $state(false);\r\n    let activeIndex = $state(-1);\r\n\r\n    // FIX: We bind to the container DIV, not the Input component\r\n    let inputContainerRef = $state<HTMLDivElement | null>(null);\r\n    let listRef = $state<HTMLDivElement | null>(null);\r\n\r\n    function open() {\r\n        isOpen = true;\r\n        activeIndex = -1;\r\n    }\r\n\r\n    function close() {\r\n        isOpen = false;\r\n        activeIndex = -1;\r\n    }\r\n\r\n    function handleInput(e: Event) {\r\n        value = (e.target as HTMLInputElement).value;\r\n        if (value.length > 0) open();\r\n        else close();\r\n    }\r\n\r\n    function handleSelect(item: T) {\r\n        selected = item;\r\n        if (onSelect) onSelect(item);\r\n        close();\r\n    }\r\n\r\n    function handleKeydown(e: KeyboardEvent) {\r\n        if (!isOpen) {\r\n            if (e.key === \"ArrowDown\" && value.length > 0) open();\r\n            return;\r\n        }\r\n\r\n        switch (e.key) {\r\n            case \"ArrowDown\":\r\n                e.preventDefault();\r\n                activeIndex = (activeIndex + 1) % options.length;\r\n                scrollToActive();\r\n                break;\r\n            case \"ArrowUp\":\r\n                e.preventDefault();\r\n                activeIndex = (activeIndex - 1 + options.length) % options.length;\r\n                scrollToActive();\r\n                break;\r\n            case \"Enter\":\r\n                e.preventDefault();\r\n                if (activeIndex >= 0 && options[activeIndex]) {\r\n                    handleSelect(options[activeIndex]);\r\n                }\r\n                break;\r\n            case \"Escape\":\r\n                close();\r\n                break;\r\n        }\r\n    }\r\n\r\n    function scrollToActive() {\r\n        if (!listRef) return;\r\n        const activeEl = listRef.children[activeIndex] as HTMLElement;\r\n        if(activeEl) {\r\n            activeEl.scrollIntoView({ block: 'nearest' });\r\n        }\r\n    }\r\n\r\n    function clickOutside(node: HTMLElement) {\r\n        const handleClick = (event: MouseEvent) => {\r\n            const target = event.target as Node;\r\n            // FIX: Check if click is outside LIST *and* outside INPUT CONTAINER\r\n            if (\r\n                node &&\r\n                !node.contains(target) &&\r\n                inputContainerRef &&\r\n                !inputContainerRef.contains(target)\r\n            ) {\r\n                close();\r\n            }\r\n        };\r\n        document.addEventListener(\"click\", handleClick, true);\r\n        return {\r\n            destroy() {\r\n                document.removeEventListener(\"click\", handleClick, true);\r\n            }\r\n        };\r\n    }\r\n</script>\r\n\r\n<div class={cn(\"relative w-full group\", className)}>\r\n\r\n    <!-- FIX: bind:this={inputContainerRef} goes here on the HTML element -->\r\n    <div class=\"relative\" bind:this={inputContainerRef}>\r\n        <Input\r\n                type=\"text\"\r\n                {placeholder}\r\n                bind:value={value}\r\n                oninput={handleInput}\r\n                onkeydown={handleKeydown}\r\n                onfocus={() => { if (value) open(); }}\r\n                role=\"combobox\"\r\n                aria-expanded={isOpen}\r\n                aria-autocomplete=\"list\"\r\n                {...rest}\r\n        />\r\n\r\n        {#if loading}\r\n            <Loader2 class=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 animate-spin text-muted-foreground\" />\r\n        {:else if value.length > 0}\r\n            <button\r\n                    class=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground\"\r\n                    onclick={() => {\r\n                        value = \"\";\r\n                        selected = null;\r\n                        // Focus the input inside the container\r\n                        inputContainerRef?.querySelector(\"input\")?.focus();\r\n                        close();\r\n                    }}\r\n                    aria-label=\"Clear\"\r\n            >\r\n                <X class=\"h-4 w-4\" />\r\n            </button>\r\n        {:else}\r\n            <!-- Search Icon only shows when empty/not loading -->\r\n            <Search class=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none\" />\r\n        {/if}\r\n    </div>\r\n\r\n    {#if isOpen}\r\n        <div\r\n                use:clickOutside\r\n                bind:this={listRef}\r\n                class=\"absolute z-50 mt-2 w-full max-h-[300px] overflow-y-auto rounded-md border bg-popover p-1 text-popover-foreground shadow-md outline-none\"\r\n                transition:fly={{ y: -5, duration: 150 }}\r\n        >\r\n            {#if options.length > 0}\r\n                {#each options as option, i}\r\n                    <!-- svelte-ignore a11y_click_events_have_key_events -->\r\n                    <!-- svelte-ignore a11y_role_has_required_aria_props -->\r\n                    <div\r\n                            role=\"option\"\r\n                            tabindex=\"-1\"\r\n                            aria-selected={i === activeIndex}\r\n                            class={cn(\r\n                            \"relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors\",\r\n                            i === activeIndex ? \"bg-accent text-accent-foreground\" : \"hover:bg-accent hover:text-accent-foreground\"\r\n                        )}\r\n                            onclick={() => handleSelect(option)}\r\n                            onmouseenter={() => activeIndex = i}\r\n                    >\r\n                        {@render itemSnippet(option, i === activeIndex)}\r\n                    </div>\r\n                {/each}\r\n            {:else if !loading}\r\n                <div class=\"py-6 text-center text-sm text-muted-foreground\">\r\n                    {#if emptySnippet}\r\n                        {@render emptySnippet()}\r\n                    {:else}\r\n                        No results found.\r\n                    {/if}\r\n                </div>\r\n            {/if}\r\n        </div>\r\n    {/if}\r\n</div>",
			"type": "registry:ui",
			"target": "autocomplete/autocomplete.svelte"
		},
		{
			"content": "<script lang=\"ts\">\r\n    let { text, query, class: className }: { text: string, query: string, class?: string } = $props();\r\n\r\n    let parts = $derived.by(() => {\r\n        if (!query) return [{ text, highlight: false }];\r\n        const regex = new RegExp(`(${query})`, 'gi');\r\n        return text.split(regex).map(part => ({\r\n            text: part,\r\n            highlight: part.toLowerCase() === query.toLowerCase()\r\n        }));\r\n    });\r\n</script>\r\n\r\n<span class={className}>\r\n    {#each parts as part}\r\n        {#if part.highlight}\r\n            <span class=\"bg-yellow-200 dark:bg-yellow-900/50 font-semibold text-foreground\">{part.text}</span>\r\n        {:else}\r\n            {part.text}\r\n        {/if}\r\n    {/each}\r\n</span>",
			"type": "registry:ui",
			"target": "autocomplete/autocomplete-highlight.svelte"
		},
		{
			"content": "import Root from \"./autocomplete.svelte\";\r\nimport Highlight from './autocomplete-highlight.svelte'\r\n\r\nexport {\r\n    Root,\r\n    Highlight\r\n};",
			"type": "registry:ui",
			"target": "autocomplete/index.ts"
		}
	]
}