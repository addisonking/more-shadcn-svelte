{
	"$schema": "https://shadcn-svelte.com/schema/registry-item.json",
	"name": "wheel-picker",
	"title": "Wheel Picker",
	"type": "registry:ui",
	"description": "An iOS-style scrollable wheel selector.",
	"files": [
		{
			"content": "<script lang=\"ts\">\n\timport { cn } from '$UTILS$';\n\timport type { Snippet } from 'svelte';\n\n\tlet { class: className, children }: { class?: string; children: Snippet } = $props();\n</script>\n\n<div class={cn('relative flex h-[200px] w-full overflow-hidden bg-background', className)}>\n\t<div\n\t\tclass=\"pointer-events-none absolute left-0 right-0 top-1/2 -translate-y-1/2 h-8 w-full bg-muted/20 border-y border-border/50 z-10\"\n\t/>\n\n\t<div\n\t\tclass=\"pointer-events-none absolute inset-x-0 top-0 h-20 bg-gradient-to-b from-background to-transparent z-20\"\n\t/>\n\t<div\n\t\tclass=\"pointer-events-none absolute inset-x-0 bottom-0 h-20 bg-gradient-to-t from-background to-transparent z-20\"\n\t/>\n\n\t<div class=\"flex h-full w-full justify-center px-4\">\n\t\t{@render children()}\n\t</div>\n</div>\n",
			"type": "registry:ui",
			"target": "wheel-picker/wheel-picker.svelte"
		},
		{
			"content": "<script lang=\"ts\">\n\timport { cn } from '$UTILS$';\n\timport { setWheelGroupContext } from './ctx';\n\timport type { Snippet } from 'svelte';\n\timport { onMount } from 'svelte';\n\n\tlet {\n\t\tvalue = $bindable(),\n\t\tclass: className,\n\t\tchildren,\n\t\tonValueChange\n\t}: {\n\t\tvalue?: string;\n\t\tclass?: string;\n\t\tchildren: Snippet;\n\t\tonValueChange?: (val: string) => void;\n\t} = $props();\n\n\tlet scrollRef: HTMLElement | undefined = $state();\n\tlet items = new Map<string, HTMLElement>();\n\tlet isInternalScroll = false;\n\tlet observer: IntersectionObserver;\n\n\tlet isDragging = $state(false);\n\tlet startY = 0;\n\tlet startScrollTop = 0;\n\n\tlet lastY = 0;\n\tlet lastTime = 0;\n\tlet velocity = 0;\n\tlet inertiaFrame: number;\n\n\tlet scrollTargetIndex: number | null = null;\n\tlet wheelTimeout: ReturnType<typeof setTimeout>;\n\n\tsetWheelGroupContext({\n\t\tregisterItem: (val, node) => items.set(val, node),\n\t\tunregisterItem: (val) => items.delete(val),\n\t\tselectedValue: () => value,\n\t\tonSelect: (val) => scrollToValue(val)\n\t});\n\n\t$effect(() => {\n\t\tif (value && !isDragging && !isInternalScroll) {\n\t\t\tscrollToValue(value);\n\t\t}\n\t});\n\n\tfunction syncScrollToValue() {\n\t\tif (!scrollRef) return;\n\t\tconst containerCenter = scrollRef.scrollTop + scrollRef.clientHeight / 2;\n\t\tlet closestDist = Infinity;\n\t\tlet closestValue: string | undefined;\n\n\t\tfor (const [val, node] of items.entries()) {\n\t\t\tconst itemCenter = node.offsetTop + node.clientHeight / 2;\n\t\t\tconst dist = Math.abs(containerCenter - itemCenter);\n\t\t\tif (dist < closestDist) {\n\t\t\t\tclosestDist = dist;\n\t\t\t\tclosestValue = val;\n\t\t\t}\n\t\t}\n\n\t\tif (closestValue && closestValue !== value) {\n\t\t\tvalue = closestValue;\n\t\t\tonValueChange?.(closestValue);\n\t\t}\n\t}\n\n\tfunction scrollToValue(val: string | undefined) {\n\t\tif (!val || !scrollRef || isDragging) return;\n\t\tconst node = items.get(val);\n\t\tif (node) {\n\t\t\tconst itemTop = node.offsetTop;\n\t\t\tconst containerCenter = scrollRef.scrollTop + scrollRef.clientHeight / 2;\n\t\t\tconst elementCenter = itemTop + node.clientHeight / 2;\n\t\t\tif (Math.abs(containerCenter - elementCenter) < 2) return;\n\n\t\t\tisInternalScroll = true;\n\t\t\tnode.scrollIntoView({ block: 'center', behavior: 'smooth' });\n\t\t\tscrollTargetIndex = null;\n\t\t\tcancelAnimationFrame(inertiaFrame);\n\t\t\tsetTimeout(() => {\n\t\t\t\tisInternalScroll = false;\n\t\t\t}, 300);\n\t\t}\n\t}\n\n\tfunction onWheel(e: WheelEvent) {\n\t\tif (!scrollRef || isDragging) return;\n\t\te.preventDefault();\n\t\tconst itemHeight = 32;\n\t\tconst direction = Math.sign(e.deltaY);\n\n\t\tif (scrollTargetIndex === null) {\n\t\t\tscrollTargetIndex = Math.round(scrollRef.scrollTop / itemHeight);\n\t\t}\n\t\tscrollTargetIndex += direction;\n\t\tconst maxIndex = items.size - 1;\n\t\tscrollTargetIndex = Math.max(0, Math.min(scrollTargetIndex, maxIndex));\n\n\t\tscrollRef.scrollTo({ top: scrollTargetIndex * itemHeight, behavior: 'smooth' });\n\n\t\tclearTimeout(wheelTimeout);\n\t\twheelTimeout = setTimeout(() => {\n\t\t\tscrollTargetIndex = null;\n\t\t\tsyncScrollToValue();\n\t\t}, 200);\n\t}\n\n\tfunction onMouseDown(e: MouseEvent) {\n\t\tif (!scrollRef) return;\n\t\tisDragging = true;\n\t\tstartY = e.clientY;\n\t\tstartScrollTop = scrollRef.scrollTop;\n\t\tscrollTargetIndex = null;\n\n\t\tlastY = e.clientY;\n\t\tlastTime = Date.now();\n\t\tvelocity = 0;\n\t\tcancelAnimationFrame(inertiaFrame);\n\n\t\tscrollRef.style.scrollSnapType = 'none';\n\t\tdocument.body.style.cursor = 'grabbing';\n\t\tdocument.body.style.userSelect = 'none';\n\n\t\twindow.addEventListener('mousemove', onMouseMove);\n\t\twindow.addEventListener('mouseup', onMouseUp);\n\t}\n\n\tfunction onMouseMove(e: MouseEvent) {\n\t\tif (!isDragging || !scrollRef) return;\n\t\te.preventDefault();\n\t\tconst delta = startY - e.clientY;\n\t\tscrollRef.scrollTop = startScrollTop + delta;\n\n\t\tconst now = Date.now();\n\t\tconst dt = now - lastTime;\n\t\tif (dt > 0) {\n\t\t\tvelocity = (e.clientY - lastY) / dt;\n\t\t\tlastY = e.clientY;\n\t\t\tlastTime = now;\n\t\t}\n\t}\n\n\tfunction onMouseUp() {\n\t\tif (!isDragging || !scrollRef) return;\n\t\tisDragging = false;\n\n\t\tdocument.body.style.cursor = '';\n\t\tdocument.body.style.userSelect = '';\n\t\twindow.removeEventListener('mousemove', onMouseMove);\n\t\twindow.removeEventListener('mouseup', onMouseUp);\n\n\t\tif (Math.abs(velocity) > 0.1) {\n\t\t\tapplyInertia();\n\t\t} else {\n\t\t\tsnapToNearest();\n\t\t}\n\t}\n\n\tfunction applyInertia() {\n\t\tif (!scrollRef) return;\n\t\tconst friction = 0.95;\n\t\tconst step = () => {\n\t\t\tif (!scrollRef) return;\n\t\t\tif (Math.abs(velocity) < 0.05) {\n\t\t\t\tsnapToNearest();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tscrollRef.scrollTop -= velocity * 16;\n\t\t\tvelocity *= friction;\n\t\t\tinertiaFrame = requestAnimationFrame(step);\n\t\t};\n\t\tstep();\n\t}\n\n\tfunction snapToNearest() {\n\t\tif (!scrollRef) return;\n\t\tconst itemHeight = 32;\n\t\tconst nearestIndex = Math.round(scrollRef.scrollTop / itemHeight);\n\n\t\tscrollRef.scrollTo({\n\t\t\ttop: nearestIndex * itemHeight,\n\t\t\tbehavior: 'smooth'\n\t\t});\n\n\t\tsetTimeout(() => {\n\t\t\tsyncScrollToValue();\n\t\t\tif (scrollRef) scrollRef.style.scrollSnapType = '';\n\t\t}, 300);\n\t}\n\n\tonMount(() => {\n\t\tif (value) {\n\t\t\tconst node = items.get(value);\n\t\t\tif (node) node.scrollIntoView({ block: 'center', behavior: 'instant' });\n\t\t}\n\n\t\tobserver = new IntersectionObserver(\n\t\t\t(entries) => {\n\t\t\t\tif (isInternalScroll || isDragging || scrollTargetIndex !== null) return;\n\n\t\t\t\tentries.forEach((entry) => {\n\t\t\t\t\tif (entry.isIntersecting) {\n\t\t\t\t\t\tconst val = entry.target.getAttribute('data-value');\n\t\t\t\t\t\tif (val && val !== value) {\n\t\t\t\t\t\t\tvalue = val;\n\t\t\t\t\t\t\tonValueChange?.(val);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t{\n\t\t\t\troot: scrollRef,\n\t\t\t\tthreshold: 0.5,\n\t\t\t\trootMargin: '-45% 0px -45% 0px'\n\t\t\t}\n\t\t);\n\n\t\titems.forEach((node) => observer.observe(node));\n\n\t\treturn () => {\n\t\t\tobserver.disconnect();\n\t\t\tcancelAnimationFrame(inertiaFrame);\n\t\t\tif (isDragging) onMouseUp();\n\t\t};\n\t});\n</script>\n\n<div\n\tbind:this={scrollRef}\n\tclass={cn(\n\t\t'no-scrollbar flex-1 h-full overflow-y-scroll snap-y snap-mandatory min-w-0 cursor-grab active:cursor-grabbing',\n\t\t'py-[84px]',\n\t\tclassName\n\t)}\n\tonwheel={onWheel}\n\tonmousedown={onMouseDown}\n\trole=\"presentation\"\n>\n\t{@render children()}\n</div>\n\n<style>\n\t.no-scrollbar::-webkit-scrollbar {\n\t\tdisplay: none;\n\t}\n\t.no-scrollbar {\n\t\t-ms-overflow-style: none;\n\t\tscrollbar-width: none;\n\t}\n</style>\n",
			"type": "registry:ui",
			"target": "wheel-picker/wheel-picker-group.svelte"
		},
		{
			"content": "<script lang=\"ts\">\n\timport { cn } from '$UTILS$';\n\timport { getWheelGroupContext } from './ctx';\n\timport type { Snippet } from 'svelte';\n\timport { onMount } from 'svelte';\n\n\tlet {\n\t\tvalue,\n\t\tclass: className,\n\t\tchildren\n\t}: {\n\t\tvalue: string;\n\t\tclass?: string;\n\t\tchildren: Snippet;\n\t} = $props();\n\n\tconst ctx = getWheelGroupContext();\n\tlet ref: HTMLElement | undefined = $state();\n\tlet isSelected = $derived(ctx.selectedValue() === value);\n\n\tonMount(() => {\n\t\tif (ref) ctx.registerItem(value, ref);\n\t\treturn () => ctx.unregisterItem(value);\n\t});\n\n\tfunction handleClick() {\n\t\tctx.onSelect(value);\n\t}\n</script>\n\n<div\n\tbind:this={ref}\n\tdata-value={value}\n\tonclick={handleClick}\n\trole=\"button\"\n\ttabindex=\"0\"\n\tonkeydown={(e) => e.key === 'Enter' && handleClick()}\n\tclass={cn(\n\t\t'flex h-8 min-h-[32px] w-full items-center justify-center snap-center text-sm transition-all duration-150 cursor-pointer select-none',\n\t\tisSelected\n\t\t\t? 'text-foreground font-semibold scale-100 opacity-100'\n\t\t\t: 'text-muted-foreground scale-90 opacity-40',\n\t\tclassName\n\t)}\n>\n\t{@render children()}\n</div>\n",
			"type": "registry:ui",
			"target": "wheel-picker/wheel-picker-item.svelte"
		},
		{
			"content": "import { getContext, setContext } from 'svelte';\n\nconst WHEEL_GROUP_KEY = Symbol('wheel-group');\n\ntype WheelGroupContext = {\n\tregisterItem: (value: string, node: HTMLElement) => void;\n\tunregisterItem: (value: string) => void;\n\tselectedValue: () => string | undefined;\n\tonSelect: (value: string) => void;\n};\n\nexport function setWheelGroupContext(props: WheelGroupContext) {\n\tsetContext(WHEEL_GROUP_KEY, props);\n}\n\nexport function getWheelGroupContext() {\n\treturn getContext<WheelGroupContext>(WHEEL_GROUP_KEY);\n}\n",
			"type": "registry:ui",
			"target": "wheel-picker/ctx.ts"
		},
		{
			"content": "import WheelPicker from './wheel-picker.svelte';\nimport WheelPickerGroup from './wheel-picker-group.svelte';\nimport WheelPickerItem from './wheel-picker-item.svelte';\n\nexport { WheelPicker as Root, WheelPickerGroup as Group, WheelPickerItem as Item };\n",
			"type": "registry:ui",
			"target": "wheel-picker/index.ts"
		}
	]
}