{
	"$schema": "https://shadcn-svelte.com/schema/registry-item.json",
	"name": "sortable",
	"title": "Sortable",
	"type": "registry:ui",
	"description": "A sortable list for vertical, horizontal, and grid layouts.",
	"dependencies": [
		"lucide-svelte@^0.554.0"
	],
	"files": [
		{
			"content": "<script lang=\"ts\">\n\timport { cn } from '$UTILS$';\n\timport { setSortableContext } from './ctx';\n\timport type { Snippet } from 'svelte';\n\timport { tick } from 'svelte';\n\n\tlet {\n\t\titems = $bindable([]),\n\t\tclass: className,\n\t\tchildren,\n\t\tonSort,\n\t\tanimation = 200,\n\t\torientation = 'vertical'\n\t}: {\n\t\titems: any[];\n\t\tclass?: string;\n\t\tchildren: Snippet;\n\t\tonSort?: (items: any[]) => void;\n\t\tanimation?: number;\n\t\torientation?: 'vertical' | 'horizontal' | 'mixed';\n\t} = $props();\n\n\tlet draggedId = $state<string | null>(null);\n\tlet itemNodes = new Map<string, HTMLElement>();\n\n\tfunction swapItems(fromIndex: number, toIndex: number) {\n\t\tconst newItems = [...items];\n\t\tconst [moved] = newItems.splice(fromIndex, 1);\n\t\tnewItems.splice(toIndex, 0, moved);\n\t\titems = newItems;\n\t\tonSort?.(newItems);\n\t}\n\n\tsetSortableContext({\n\t\tgetDraggedId: () => draggedId,\n\t\tregisterItem: (id, node) => itemNodes.set(id, node),\n\t\tunregisterItem: (id) => itemNodes.delete(id),\n\n\t\tonDragStart: (e, id) => {\n\t\t\tdraggedId = id;\n\t\t\tdocument.body.style.cursor = 'grabbing';\n\n\t\t\tif (e.dataTransfer) {\n\t\t\t\te.dataTransfer.effectAllowed = 'move';\n\t\t\t\tconst img = new Image();\n\t\t\t\timg.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n\t\t\t\te.dataTransfer.setDragImage(img, 0, 0);\n\t\t\t}\n\t\t},\n\n\t\tonDragOver: async (e, targetId) => {\n\t\t\te.preventDefault();\n\t\t\tif (!draggedId || draggedId === targetId) return;\n\n\t\t\tconst targetNode = itemNodes.get(targetId);\n\t\t\tif (!targetNode) return;\n\n\t\t\tconst rect = targetNode.getBoundingClientRect();\n\n\t\t\tconst midY = rect.top + rect.height / 2;\n\t\t\tconst midX = rect.left + rect.width / 2;\n\n\t\t\tconst fromIdx = items.findIndex((i) => i.id === draggedId);\n\t\t\tconst toIdx = items.findIndex((i) => i.id === targetId);\n\n\t\t\tif (fromIdx === -1 || toIdx === -1) return;\n\n\t\t\tconst isVertical = orientation === 'vertical';\n\n\t\t\tif (isVertical) {\n\t\t\t\tif (fromIdx < toIdx && e.clientY < midY) return;\n\t\t\t\tif (fromIdx > toIdx && e.clientY > midY) return;\n\t\t\t} else {\n\t\t\t\tif (fromIdx < toIdx && e.clientX < midX) return;\n\t\t\t\tif (fromIdx > toIdx && e.clientX > midX) return;\n\t\t\t}\n\n\t\t\tconst currentPositions = new Map<string, DOMRect>();\n\t\t\titemNodes.forEach((node, id) => {\n\t\t\t\tcurrentPositions.set(id, node.getBoundingClientRect());\n\t\t\t});\n\n\t\t\tswapItems(fromIdx, toIdx);\n\t\t\tawait tick();\n\n\t\t\titemNodes.forEach((node, id) => {\n\t\t\t\tconst oldRect = currentPositions.get(id);\n\t\t\t\tif (oldRect) {\n\t\t\t\t\tconst newRect = node.getBoundingClientRect();\n\t\t\t\t\tconst diffX = oldRect.left - newRect.left;\n\t\t\t\t\tconst diffY = oldRect.top - newRect.top;\n\n\t\t\t\t\tif (Math.abs(diffX) > 0 || Math.abs(diffY) > 0) {\n\t\t\t\t\t\tnode.style.transform = `translate(${diffX}px, ${diffY}px)`;\n\t\t\t\t\t\tnode.style.transition = 'none';\n\n\t\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\t\tnode.style.transform = '';\n\t\t\t\t\t\t\tnode.style.transition = `transform ${animation}ms cubic-bezier(0.2, 0, 0, 1)`;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tonDragEnd: () => {\n\t\t\tdraggedId = null;\n\t\t\tdocument.body.style.cursor = '';\n\t\t}\n\t});\n\n\tfunction handleContainerDragOver(e: DragEvent) {\n\t\te.preventDefault();\n\t}\n</script>\n\n<div\n\tclass={cn(\n\t\t'relative flex',\n\t\torientation === 'vertical' ? 'flex-col gap-2' : 'flex-wrap gap-4',\n\t\tclassName\n\t)}\n\tondragover={handleContainerDragOver}\n\trole=\"list\"\n>\n\t{@render children()}\n</div>\n",
			"type": "registry:ui",
			"target": "sortable/sortable.svelte"
		},
		{
			"content": "<script lang=\"ts\">\n\timport { cn } from '$UTILS$';\n\timport { getSortableContext } from './ctx';\n\timport type { Snippet } from 'svelte';\n\timport { onDestroy, onMount } from 'svelte';\n\n\tlet {\n\t\tid,\n\t\tclass: className,\n\t\tchildren\n\t}: {\n\t\tid: string;\n\t\tclass?: string;\n\t\tchildren: Snippet;\n\t} = $props();\n\n\tconst ctx = getSortableContext();\n\tlet ref: HTMLElement | undefined = $state();\n\n\tlet isDragging = $derived(ctx.getDraggedId() === id);\n\n\tonMount(() => {\n\t\tif (ref) ctx.registerItem(id, ref);\n\t});\n\n\tonDestroy(() => {\n\t\tctx.unregisterItem(id);\n\t});\n</script>\n\n<div\n\tbind:this={ref}\n\tdata-sortable-id={id}\n\tclass={cn(\n\t\t'relative transition-transform touch-none',\n\t\tisDragging && 'z-50 opacity-50 ring-2 ring-primary ring-offset-2 rounded-lg',\n\t\tclassName\n\t)}\n\tdraggable=\"false\"\n\tondragstart={(e) => ctx.onDragStart(e, id)}\n\tondragover={(e) => ctx.onDragOver(e, id)}\n\tondragend={(e) => ctx.onDragEnd(e)}\n\trole=\"listitem\"\n>\n\t{@render children()}\n</div>\n",
			"type": "registry:ui",
			"target": "sortable/sortable-item.svelte"
		},
		{
			"content": "<script lang=\"ts\">\n\timport { cn } from '$UTILS$';\n\timport { GripVertical } from 'lucide-svelte';\n\timport type { Snippet } from 'svelte';\n\n\tlet { class: className, children }: { class?: string; children?: Snippet } = $props();\n\n\tfunction setDraggable(e: MouseEvent | TouchEvent) {\n\t\tconst item = (e.target as HTMLElement).closest('[data-sortable-id]') as HTMLElement;\n\t\tif (item) item.draggable = true;\n\t}\n\n\tfunction unsetDraggable(e: MouseEvent | TouchEvent) {\n\t\tconst item = (e.target as HTMLElement).closest('[data-sortable-id]') as HTMLElement;\n\t\tif (item) item.draggable = false;\n\t}\n</script>\n\n<div\n\tclass={cn(\n\t\t'cursor-grab active:cursor-grabbing text-muted-foreground hover:text-foreground touch-none',\n\t\tclassName\n\t)}\n\tonmousedown={setDraggable}\n\tonmouseup={unsetDraggable}\n\tonmouseleave={unsetDraggable}\n\tontouchstart={setDraggable}\n\tontouchend={unsetDraggable}\n\trole=\"button\"\n\ttabindex=\"0\"\n\taria-label=\"Drag to reorder\"\n>\n\t{#if children}\n\t\t{@render children()}\n\t{:else}\n\t\t<GripVertical class=\"h-4 w-4\" />\n\t{/if}\n</div>\n",
			"type": "registry:ui",
			"target": "sortable/sortable-handle.svelte"
		},
		{
			"content": "import { getContext, setContext } from 'svelte';\n\nconst SORTABLE_KEY = Symbol('sortable');\n\ntype SortableContext = {\n\tregisterItem: (id: string, node: HTMLElement) => void;\n\tunregisterItem: (id: string) => void;\n\tonDragStart: (e: DragEvent, id: string) => void;\n\tonDragOver: (e: DragEvent, id: string) => void;\n\tonDragEnd: (e: DragEvent) => void;\n\tgetDraggedId: () => string | null;\n};\n\nexport function setSortableContext(props: SortableContext) {\n\tsetContext(SORTABLE_KEY, props);\n}\n\nexport function getSortableContext() {\n\treturn getContext<SortableContext>(SORTABLE_KEY);\n}\n",
			"type": "registry:ui",
			"target": "sortable/ctx.ts"
		},
		{
			"content": "import Sortable from './sortable.svelte';\nimport SortableItem from './sortable-item.svelte';\nimport SortableHandle from './sortable-handle.svelte';\n\nexport { Sortable as Root, SortableItem as Item, SortableHandle as Handle };\n",
			"type": "registry:ui",
			"target": "sortable/index.ts"
		}
	]
}